{"remainingRequest":"/home/quantium/labs/solana-nft-python/nft-armory/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/home/quantium/labs/solana-nft-python/nft-armory/src/views/ViewView.vue?vue&type=style&index=0&id=698d1c24&lang=css","dependencies":[{"path":"/home/quantium/labs/solana-nft-python/nft-armory/src/views/ViewView.vue","mtime":1666703689733},{"path":"/home/quantium/labs/solana-nft-python/nft-armory/node_modules/css-loader/dist/cjs.js","mtime":1666703776180},{"path":"/home/quantium/labs/solana-nft-python/nft-armory/node_modules/vue-loader-v16/dist/stylePostLoader.js","mtime":1666703777264},{"path":"/home/quantium/labs/solana-nft-python/nft-armory/node_modules/postcss-loader/src/index.js","mtime":1666703776480},{"path":"/home/quantium/labs/solana-nft-python/nft-armory/node_modules/cache-loader/dist/cjs.js","mtime":1666703775764},{"path":"/home/quantium/labs/solana-nft-python/nft-armory/node_modules/vue-loader-v16/dist/index.js","mtime":1666703776480}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci8qdGVtcCBoYWNrYXJvdW5kLi4uKi8KLmluZmluaXRlLXN0YXR1cy1wcm9tcHQgewogIEBhcHBseSB0ZXh0LXdoaXRlICFpbXBvcnRhbnQ7Cn0K"},{"version":3,"sources":["/home/quantium/labs/solana-nft-python/nft-armory/src/views/ViewView.vue"],"names":[],"mappings":";AA2OA,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACrB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACtB,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC9B","file":"/home/quantium/labs/solana-nft-python/nft-armory/src/views/ViewView.vue","sourceRoot":"","sourcesContent":["<template>\n  <div>\n    <!--all the config stuff-->\n    <ConfigPane />\n    <NFTViewForm :is-loading=\"isLoading\" @submit-form=\"handleSubmitForm\">\n      <div v-if=\"NFTs.length\" class=\"flex\">\n        <button type=\"button\" class=\"nes-btn mr-2\" @click=\"copyShareLink\">\n          {{ copyText }}\n        </button>\n        <button\n          type=\"button\"\n          class=\"nes-btn\"\n          :class=\"{ 'is-disabled': disableExport }\"\n          @click=\"exportNFTs\"\n          :disabled=\"disableExport\"\n        >\n          {{ exportBtnText }}\n        </button>\n        <QuestionMark class=\"ml-1 mt-3\" @click=\"showModal('tooltipExport')\" />\n      </div>\n    </NFTViewForm>\n\n    <!--per NFT display-->\n    <LoadingBar v-if=\"isLoading\" :progress=\"progress\" :text=\"text\" class=\"my-5\" />\n    <NotifyError v-else-if=\"isError\" class=\"mt-5\">{{ text }}</NotifyError>\n    <div v-else>\n      <NFTViewCard v-for=\"n in NFTs\" :key=\"n.mint\" :n=\"n\"></NFTViewCard>\n    </div>\n\n    <!--modals-->\n    <ModalWindow\n      v-if=\"isModalVisible('tooltipExport')\"\n      title=\"Wen export??\"\n      @hide-modal=\"hideModal('tooltipExport')\"\n    >\n      <ContentTooltipExport />\n    </ModalWindow>\n\n    <!--must sit at the very bottom-->\n    <infinite-loading\n      @infinite=\"infiniteHandler\"\n      :identifier=\"\n        +new Date() //needs to be something thta dynamically updates, or won't work\n      \"\n      spinner=\"spiral\"\n    ></infinite-loading>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref, watch } from 'vue';\nimport InfiniteLoading from 'vue-infinite-loading';\nimport 'vue-json-pretty/lib/styles.css';\nimport ConfigPane from '@/components/ConfigPane.vue';\nimport LoadingBar from '@/components/LoadingBar.vue';\nimport { NFTGet } from '@/common/NFTget';\nimport NFTViewCard from '@/components/NFTViewCard.vue';\nimport useLoading, { LoadStatus } from '@/composables/loading';\nimport { EE, ERR_NO_NFTS } from '@/globals';\nimport { INFT, INFTParams } from '@/common/helpers/types';\nimport NFTViewForm from '@/components/NFTViewForm.vue';\nimport useDownload from '@/composables/download';\nimport useCopy from '@/composables/copy';\nimport NotifyError from '@/components/notifications/NotifyError.vue';\nimport QuestionMark from '@/components/QuestionMark.vue';\nimport ModalWindow from '@/components/ModalWindow.vue';\nimport ContentTooltipExport from '@/components/content/tooltip/ContentTooltipExport.vue';\nimport useModal from '@/composables/modal';\n\nexport default defineComponent({\n  components: {\n    ContentTooltipExport,\n    ModalWindow,\n    QuestionMark,\n    NotifyError,\n    NFTViewForm,\n    NFTViewCard,\n    LoadingBar,\n    ConfigPane,\n    InfiniteLoading,\n  },\n  setup() {\n    const {\n      progress,\n      text,\n      isLoading,\n      isError,\n      updateLoading,\n      updateLoadingStdErr,\n      updateLoadingStdWin,\n    } = useLoading();\n    const displayedNFTs = ref<INFT[]>([]); // this is what's shown on FE\n    const allFetchedNFTs = ref<INFT[]>([]); // this is everything fetched in mem\n    const fetchParams = ref<INFTParams | null>(null);\n    const NFTCount = computed(() => displayedNFTs.value.length + allFetchedNFTs.value.length);\n\n    const getNextBatch = (size: number): INFT[] => {\n      if (allFetchedNFTs.value.length === 0) {\n        return [];\n      }\n      if (allFetchedNFTs.value.length > size) {\n        return allFetchedNFTs.value.splice(0, size);\n      }\n      return allFetchedNFTs.value.splice(0, allFetchedNFTs.value.length);\n    };\n\n    const fetchNFTs = (params: INFTParams) => {\n      updateLoading({\n        newStatus: LoadStatus.Loading,\n        newProgress: 0,\n        maxProgress: 50,\n        newText: 'Looking for NFTs... ETA: <1 min',\n      });\n\n      EE.removeAllListeners();\n      EE.on('loading', updateLoading);\n\n      // clear for new fetch\n      displayedNFTs.value = [];\n      allFetchedNFTs.value = [];\n\n      NFTGet(params)\n        .then((fetchedNFTs) => {\n          if (fetchedNFTs.length) {\n            allFetchedNFTs.value = fetchedNFTs;\n            const nextBatch = getNextBatch(10);\n            displayedNFTs.value.push(...nextBatch);\n            updateLoadingStdWin();\n          } else {\n            updateLoadingStdErr(ERR_NO_NFTS);\n          }\n        })\n        .catch(updateLoadingStdErr);\n    };\n\n    const handleSubmitForm = (params: INFTParams) => {\n      fetchParams.value = params;\n      fetchNFTs(params);\n    };\n\n    // --------------------------------------- display\n    const infiniteHandler = ($state: any) => {\n      const nextBatch = getNextBatch(10);\n      if (nextBatch.length) {\n        displayedNFTs.value.push(...nextBatch);\n        $state.loaded();\n      } else {\n        $state.complete();\n      }\n    };\n\n    // --------------------------------------- export\n    const { exportJSONZip } = useDownload();\n    const exportBtnText = ref(`Export ${NFTCount.value} NFTs`);\n    const disableExport = ref(false);\n    watch(NFTCount, (newCount) => {\n      exportBtnText.value = `Export ${newCount} NFTs`;\n    });\n\n    const parseParams = (): [string, string] => {\n      let returnKey: string;\n      let returnPk: string;\n      for (const [k, v] of Object.entries(fetchParams.value!)) {\n        if (v && v instanceof Array) {\n          returnKey = k;\n          returnPk = v[0].toBase58(); // get the first creator\n        } else if (v) {\n          returnKey = k;\n          returnPk = v.toBase58();\n        }\n      }\n      return [returnKey!, returnPk!];\n    };\n\n    const doneExportingCallback = () => {\n      disableExport.value = false;\n      exportBtnText.value = `Export ${NFTCount.value} NFTs`;\n    };\n\n    const exportNFTs = () => {\n      disableExport.value = true;\n      exportBtnText.value = 'preparing...';\n      const allNFTs = displayedNFTs.value.concat(allFetchedNFTs.value);\n      const now = +new Date();\n      const [k, v] = parseParams();\n      exportJSONZip(allNFTs, 'mint', `${k}-${v}-${now}`, doneExportingCallback);\n    };\n\n    // --------------------------------------- sharing\n    const { copyText, setCopyText, doCopy } = useCopy();\n    setCopyText('Share Link');\n\n    const copyShareLink = async () => {\n      const host = window.location.origin;\n      if (fetchParams.value!.owner) {\n        await doCopy(`${host}/view/address/${fetchParams.value!.owner.toBase58()}`);\n      } else if (fetchParams.value!.creator) {\n        await doCopy(`${host}/view/creator/${fetchParams.value!.creator.toBase58()}`);\n      } else if (fetchParams.value!.updateAuthority) {\n        await doCopy(`${host}/view/authority/${fetchParams.value!.updateAuthority.toBase58()}`);\n      } else if (fetchParams.value!.mint) {\n        await doCopy(`${host}/view/mint/${fetchParams.value!.mint.toBase58()}`);\n      }\n    };\n\n    // --------------------------------------- modal\n    const { registerModal, isModalVisible, showModal, hideModal } = useModal();\n    registerModal('tooltipExport');\n\n    return {\n      NFTs: displayedNFTs,\n      progress,\n      text,\n      isLoading,\n      isError,\n      exportNFTs,\n      handleSubmitForm,\n      infiniteHandler,\n      // export\n      exportBtnText,\n      disableExport,\n      // share\n      copyText,\n      copyShareLink,\n      doCopy,\n      // modal\n      isModalVisible,\n      showModal,\n      hideModal,\n    };\n  },\n});\n</script>\n\n<style>\n/*temp hackaround...*/\n.infinite-status-prompt {\n  @apply text-white !important;\n}\n</style>\n"]}]}